---
title: "Introduction to fishflux"
author: "Nina Schiettekatte"
output:
  pdf_document:
    citation_package: natbib
    fig_caption: yes
    keep_tex: yes
    latex_engine: pdflatex
  html_document:
    fig_caption: yes
header-includes:
- \usepackage{graphicx}
- \usepackage{float}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


<img src="man/figures/fishflux.png" width = 120 alt="fishflux logo"/> 

## Introduction

The `fishflux` package provides a tool to model fluxes of C (carbon), N (nitrogen) and P (phosphorus) in fish. It combines basic principles from elemental stoichiometry and metabolic theory. The package offers a user friendly interface to make nutrient dynamic modelling available for anyone. `fishflux` is mostly targeted towards fish ecologists, wishing to predict nutrient ingestion, egestion and excretion to study fluxes of nutrients and energy. 

Main assets:

* Provides functions to model fluxes of Carbon, Nitrogen and Phosphorus for fish with or without the MCMC sampler provided by stan.
* Provides some tools to find the right parameters as inputs into the model
* Provides a plotting function to illustrate results

## Installing and loading fishflux

`fishflux` uses Markov Chain Monte Carlo simulations provided by [stan](https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started). Therefore, the first step is to install [stan](https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started).

### GitHub

The best way to install the latest development version of `fishflux` is to install it from GitHub. 

```r
install.packages("devtools")
devtools::install_github("nschiett/fishflux", dependencies=TRUE)
library(fishflux)
```
### CRAN

`fishflux` will be available on CRAN in the future:

```r
install.packages("fishflux")
library(fishflux)
```

### Downloaded package file

Another option is to download the source file available on GitHub [here](https://github.com/nschiett/fishflux).

```r
install.packages(path_to_fishflux_file, repos = NULL, type="source")
library(fishflux)
```

## How to use fishflux?

`fishflux` is designed to follow three simple steps:
1. Find the right input parameters
2. Run the model simulation with those input parameters
3. Plot the model results

### Find parameters

Below a table showing all parameters needed to run the model simulation. `fishflux` provides functions to find some of these parameters, but note that others have to be provided by the user at this stage. 

```{r,message=FALSE,echo=FALSE,results='asis'}
knitr::kable(data.frame(
  Parameters = c("C","N","P","Fc","Fn","Fp","AEc","AEn","AEp","Linf","k","t0","lwa","lwb","w_prop","Tn","Tp","B0","a","f","asp","troph","temp"), 
  Description = c("Carbon content of fish (%)", "Nitrogen content of fish (%)","Phosphorus content of fish (%)","C content of food (%)","N content of food (%)","P content of food (%)", "C-specific absorption efficiency", "N-specific absorption efficienct","P-specific absorption efficiency", "Von Bertalanffy growth parameter","Von Bertalanffy growth parameter","Von Bertalanffy growth parameter", "Parameter length-weight relationship","Parameter length-weight relationship","Ratio between dry weight and wet weight of fish","N-specific turnover rate","P-specific turnover rate","Normalisation constant for resting metabolic rate", "Resting metabolic rate mass-scaling exponent","Activity scope","Aspect ratio","Trophic level","Temperature (Â°C)")
),caption = "Overview all input variables")
```

A good place to start is to check if you are using the correct scientific name of your fish of interest. The function `name_errors` will tell you if the species name is correct. This function can be useful, especially when working with larger databases.  

```{r,message=TRUE,echo=TRUE}
# example
fishflux::name_errors("Zebrazoma scopas")
```

Once the species names are verified and/or corrected we can continue with specifying some parameters. 

The `find_lw` function searches fishbase to find length-weight relationship parameters `lw_a` and `lw_b` obtained from @Froese2013. 

```{r,message=TRUE,echo=TRUE}
# example
fishflux::find_lw("Zebrasoma scopas")
```

Further, there are a couple more basic functions to get an indication of parameters that are available on fishbase such as `growth_params()`, `trophic_level()` and `aspect_ratio()`. Be aware to interpret these estimates with a critical eye, as they come from disparate sources of varying accuracy. It is always better to get the parameters yourself through experiments and otolith analys

```{r,message=TRUE,echo=TRUE}
# example
# The option otolith=TRUE filters out sources that used otoliths for the estimation of growth parameters
fishflux::growth_params("Zebrasoma scopas", otolith = TRUE)
```

```{r,message=TRUE,echo=TRUE}
# example
fishflux::model_parameters("Zebrasoma scopas", family = "Acanthuridae")
```

